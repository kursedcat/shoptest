<!DOCTYPE html>
<html>
<head>
    <title>Подключение связи</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f2f5;
        }
        .button {
            background-color: #0088cc;
            color: white;
            padding: 15px 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="debug"></div>
    <div>
        <h3>Оформление заявки</h3>
        <select id="tariff">
            <option value="Интернет 100">Интернет 100 Мбит/с - 799 ₽/мес</option>
            <option value="Интернет + ТВ">Интернет + ТВ - 999 ₽/мес</option>
        </select>
        <input type="text" id="address" placeholder="Введите адрес">
        <button class="button" onclick="submitOrder()">Отправить заявку</button>
    </div>

    <script>
        // Функция для отладки
        function debug(text) {
            document.getElementById('debug').innerHTML += text + '<br>';
            console.log(text);
        }

        // Проверяем инициализацию WebApp
        if (window.Telegram.WebApp) {
            debug('WebApp доступен');
        } else {
            debug('WebApp не доступен');
        }

        function submitOrder() {
            debug('Начало отправки заказа');
            
            const webApp = window.Telegram.WebApp;
            const tariff = document.getElementById('tariff').value;
            const address = document.getElementById('address').value;

            if (!address) {
                debug('Адрес не указан');
                alert('Пожалуйста, введите адрес');
                return;
            }

            const data = {
                action: "buy",
                product: tariff,
                address: address
            };

            debug('Подготовленные данные: ' + JSON.stringify(data));

            try {
                webApp.sendData(JSON.stringify(data));
                debug('Данные отправлены');
            } catch (e) {
                debug('Ошибка при отправке: ' + e.message);
            }
        }

        // Инициализация WebApp
        window.Telegram.WebApp.ready();
        debug('WebApp готов');
    </script>
</body>
</html>
